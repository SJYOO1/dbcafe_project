<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Cafe Account Management System ☆★☆★</title>
<link
	href="https://unpkg.com/bootstrap@5.2.1/dist/css/bootstrap.min.css"
	rel="stylesheet">
<script
	src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/jquery@3.6.1/dist/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.0/axios.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>	

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
	<style type="text/css">
		a:link { text-decoration: none; color: black; }
		a:active { text-decoration: none; color: green; }
		a:hover { text-decoration: none; color: black; font-weight: bold; }
		a:visited { text-decoration: none; color: black; }
	</style>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> <!-- axios사용 -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<style type="text/css">
/* div {
	margin: 5px;
	padding: 5px;
	border: 1px solid gray;
	height: 700px;
} */
</style>
<script type="text/javascript">
	$(function() {
		$("#btn").click(function() {
			var startDay = $("input[name='startDay']").val();
			var endDay = $("input[name='endDay']").val();
			// 서버와 비동기 통신
			// 컨트롤러에 값 넘겨주기
			$.ajax({
				url : "/category",
				contentType : "application/json;charset=utf-8",
				dataType : "json",
				type : "get",
				data : {
					startDay : startDay,
					endDay : endDay
				},
				success : function(cdata) {
					google.charts.load('current', {'packages':['corechart']});
				      // Google Visualization API가 로드될 때 실행할 콜백함수를 설정합니다.
				      google.charts.setOnLoadCallback(drawChart);
				      // 데이터 테이블을 생성하고 채우는 콜백,
				      // 원형 차트를 인스턴스화하고 데이터를 전달하고
				      // 그립니다. 
				      function drawChart() {
				    	  var data = new google.visualization.DataTable();
				    	  data.addColumn('string', '메뉴항목');
				    	  data.addColumn('number', '매출비중');
				    	 for(var i=0;i<cdata.length;i++){
				    		  data.addRow([
				    			cdata[i].category, cdata[i].csum
				    		  ]);
				    	 }				    	
				        // 차트옵션선택
				        var options = {'title':'카테고리별 매출 비중 (원)',
				                       'width':800,
				                       'height':600};
				        // 몇 가지 옵션을 전달하여 차트를 인스턴스화하고 그립니다.
				        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
				        chart.draw(data, options);
				      }
				      
					  google.charts.load('current', {'packages':['corechart']});
				      google.charts.setOnLoadCallback(drawChart2);
				      function drawChart2() {
				    	  var data = new google.visualization.DataTable();
				    	  data.addColumn('string', '메뉴항목');
				    	  data.addColumn('number', '매출비중');
				    	 for(var i=0;i<cdata.length;i++){
				    		  data.addRow([
				    			cdata[i].category, cdata[i].ccount
				    		  ]);
				    	 }
				        var options = {'title':'카테고리별 판매량 비중 (건)',
				                       'width':800,
				                       'height':600};
				        var chart = new google.visualization.PieChart(document.getElementById('chart_div2'));
				        chart.draw(data, options);
				      }
				},
				error : function(data) {
					alert("Error");
				}
			});
		});
	});
</script>
</head>
<body>
	<input type="date" id="startDay" name="startDay" value="2020-03-01" />
	<input type="date" id="endDay" name="endDay" value="2020-03-10" />
	<button id="btn">제출</button>
	<hr />
	<div id="info"></div>
	<script>
		/* document.getElementById('startDay').value=new Date().toISOString().slice(0,10);
		document.getElementById('endDay').value=new Date().toISOString().slice(0,10); */
	</script>
	<div id="chart_div"></div>	
	<div id="chart_div2"></div>	
</body>
</html>
